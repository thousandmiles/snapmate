<ui:FluentWindow
    x:Class="SnapMate.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:SnapMate.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    Title="SnapMate"
    Width="1400"
    Height="800"
    ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<!--  Title Bar  -->
		<ui:TitleBar Title="SnapMate" Grid.Row="0" />

		<!--  Main Content Area  -->
		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<!--  Left Panel: History (280px default, resizable 200-400px)  -->
				<ColumnDefinition
                    Width="280"
                    MinWidth="200"
                    MaxWidth="400" />
				<ColumnDefinition Width="Auto" />
				<!--  Right Area: Editing Canvas  -->
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>

			<!--  LEFT PANEL: History List  -->
			<Border
                Grid.Column="0"
                Background="{DynamicResource ControlFillColorDefaultBrush}"
                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                BorderThickness="0,0,1,0">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="*" />
					</Grid.RowDefinitions>

					<!--  History Header  -->
					<StackPanel Grid.Row="0" Margin="15,15,15,10">
						<TextBlock
                            Margin="0,0,0,10"
                            FontSize="20"
                            FontWeight="SemiBold"
                            Text="History" />

						<!--  Search Box  -->
						<ui:TextBox
                            Icon="{ui:SymbolIcon Search24}"
                            PlaceholderText="Search..."
                            Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" />
					</StackPanel>

					<!--  Quick Actions  -->
					<StackPanel
                        Grid.Row="1"
                        Margin="15,5,15,10"
                        Orientation="Horizontal">
						<ui:Button
                            Margin="0,0,5,0"
                            Appearance="Primary"
                            Content="New"
                            Icon="{ui:SymbolIcon Add24}"
                            ToolTip="New Screenshot (Ctrl+N)" />
						<ui:Button
                            Margin="0,0,5,0"
                            Command="{Binding ClearHistoryCommand}"
                            Content="Clear"
                            Icon="{ui:SymbolIcon Delete24}"
                            ToolTip="Clear All History" />
						<ui:Button Icon="{ui:SymbolIcon Settings24}" ToolTip="Settings" />
					</StackPanel>

					<!--  History List with Thumbnails  -->
					<ListView
                        Grid.Row="2"
                        Margin="10,0,10,10"
                        BorderThickness="0"
                        ItemsSource="{Binding Screenshots}"
                        ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                        SelectedItem="{Binding SelectedScreenshot}">
						<ListView.ItemTemplate>
							<DataTemplate>
								<Border
                                    Margin="0,0,0,10"
                                    Padding="10"
                                    Background="{DynamicResource ControlFillColorSecondaryBrush}"
                                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                    BorderThickness="1"
                                    CornerRadius="8">
									<Grid>
										<Grid.RowDefinitions>
											<RowDefinition Height="Auto" />
											<RowDefinition Height="Auto" />
											<RowDefinition Height="Auto" />
										</Grid.RowDefinitions>

										<!--  Thumbnail Preview Placeholder  -->
										<Border
                                            Grid.Row="0"
                                            Height="120"
                                            Margin="0,0,0,8"
                                            Background="{DynamicResource ControlFillColorTertiaryBrush}"
                                            CornerRadius="4">
											<TextBlock
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                FontSize="48"
                                                Opacity="0.3"
                                                Text="??" />
										</Border>

										<!--  Title/Date  -->
										<TextBlock
                                            Grid.Row="1"
                                            Margin="0,0,0,4"
                                            FontWeight="SemiBold"
                                            Text="{Binding Title, FallbackValue='Untitled'}"
                                            TextTrimming="CharacterEllipsis" />

										<!--  Metadata  -->
										<TextBlock
                                            Grid.Row="2"
                                            FontSize="11"
                                            Foreground="{DynamicResource TextFillColorSecondaryBrush}">
											<Run Text="{Binding CapturedAt, StringFormat=yyyy-MM-dd HH:mm}" />
											<Run Text="?" />
											<Run Text="{Binding Type}" />
										</TextBlock>
									</Grid>
								</Border>
							</DataTemplate>
						</ListView.ItemTemplate>
					</ListView>
				</Grid>
			</Border>

			<!--  Resizable Splitter  -->
			<GridSplitter
                Grid.Column="1"
                Width="4"
                HorizontalAlignment="Center"
                VerticalAlignment="Stretch"
                Background="Transparent"
                ShowsPreview="True" />

			<!--  RIGHT AREA: Editing Canvas  -->
			<Grid Grid.Column="2">
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="*" />
				</Grid.RowDefinitions>

				<!--  TOP TOOLBAR: Editing Tools  -->
				<Border
                    Grid.Row="0"
                    Padding="15,10"
                    Background="{DynamicResource ControlFillColorDefaultBrush}"
                    BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                    BorderThickness="0,0,0,1">
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="*" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>

						<!--  Capture Tools  -->
						<StackPanel Grid.Column="0" Orientation="Horizontal">
							<TextBlock
                                Margin="0,0,10,0"
                                VerticalAlignment="Center"
                                FontWeight="SemiBold"
                                Text="Capture:" />

							<ui:Button
                                Margin="0,0,5,0"
                                Appearance="Primary"
                                Command="{Binding CaptureRegionCommand}"
                                Content="Region"
                                Icon="{ui:SymbolIcon Crop24}"
                                ToolTip="Region Capture (Ctrl+Shift+A)" />

							<ui:Button
                                Margin="0,0,5,0"
                                Command="{Binding CaptureFullScreenCommand}"
                                Content="Full Screen"
                                Icon="{ui:SymbolIcon FullScreenMaximize24}"
                                ToolTip="Full Screen (Ctrl+Shift+S)" />

							<ui:Button
                                Margin="0,0,15,0"
                                Command="{Binding CaptureWindowCommand}"
                                Content="Window"
                                Icon="{ui:SymbolIcon Window24}"
                                ToolTip="Window Capture (Ctrl+Shift+W)" />
						</StackPanel>

						<!--  Editing Tools  -->
						<StackPanel
                            Grid.Column="1"
                            HorizontalAlignment="Center"
                            Orientation="Horizontal">
							<Separator Margin="10,0" Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />

							<TextBlock
                                Margin="0,0,10,0"
                                VerticalAlignment="Center"
                                FontWeight="SemiBold"
                                Text="Edit:" />

							<ui:Button
                                Margin="0,0,5,0"
                                Icon="{ui:SymbolIcon ArrowUp24}"
                                ToolTip="Arrow Tool" />

							<ui:Button
                                Margin="0,0,5,0"
                                Icon="{ui:SymbolIcon RectangleLandscape24}"
                                ToolTip="Rectangle Tool" />

							<ui:Button
                                Margin="0,0,5,0"
                                Icon="{ui:SymbolIcon TextFont24}"
                                ToolTip="Text Tool" />

							<ui:Button
                                Margin="0,0,5,0"
                                Icon="{ui:SymbolIcon Blur24}"
                                ToolTip="Mosaic/Blur Tool" />

							<Separator Margin="10,0" Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
						</StackPanel>

						<!--  Action Tools  -->
						<StackPanel Grid.Column="2" Orientation="Horizontal">
							<ui:Button
                                Margin="0,0,5,0"
                                Command="{Binding CopyToClipboardCommand}"
                                Content="Copy"
                                Icon="{ui:SymbolIcon Copy24}"
                                ToolTip="Copy to Clipboard (Ctrl+C)" />

							<ui:Button
                                Margin="0,0,5,0"
                                Command="{Binding SaveImageCommand}"
                                Content="Save"
                                Icon="{ui:SymbolIcon Save24}"
                                ToolTip="Save Image (Ctrl+S)" />

							<ui:Button
                                Command="{Binding ExtractTextCommand}"
                                Content="OCR"
                                Icon="{ui:SymbolIcon DocumentSearch24}"
                                ToolTip="Extract Text" />
						</StackPanel>
					</Grid>
				</Border>

				<!--  CENTRAL CANVAS: Image Editing Area  -->
				<Border
                    Grid.Row="1"
                    Margin="10"
                    Background="{DynamicResource ApplicationBackgroundBrush}">
					<Grid>
						<!--  Empty State  -->
						<StackPanel
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Visibility="{Binding CurrentImage, Converter={StaticResource NullToVisibilityConverter}}">
							<TextBlock
                                Margin="0,0,0,20"
                                HorizontalAlignment="Center"
                                FontSize="72"
                                Opacity="0.3"
                                Text="??" />
							<TextBlock
                                Margin="0,0,0,10"
                                HorizontalAlignment="Center"
                                FontSize="24"
                                FontWeight="SemiBold"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Text="No Screenshot Selected" />
							<TextBlock
                                HorizontalAlignment="Center"
                                FontSize="14"
                                Foreground="{DynamicResource TextFillColorTertiaryBrush}"
                                Text="Capture a new screenshot or select from history" />
						</StackPanel>

						<!--  Image Display with Annotation Layer  -->
						<ScrollViewer
                            HorizontalScrollBarVisibility="Auto"
                            VerticalScrollBarVisibility="Auto"
                            Visibility="{Binding CurrentImage, Converter={StaticResource NotNullToVisibilityConverter}}">
							<Border
                                Padding="10"
                                Background="White"
                                BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
                                BorderThickness="1"
                                CornerRadius="8">
								<Grid>
									<!--  Base Image  -->
									<Image
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Source="{Binding CurrentImage}"
                                        Stretch="Uniform" />

									<!--  Annotation Overlay Layer  -->
									<Canvas Background="Transparent" />
								</Grid>
							</Border>
						</ScrollViewer>
					</Grid>
				</Border>
			</Grid>
		</Grid>

		<!--  Status Bar  -->
		<Border
            Grid.Row="2"
            Padding="15,8"
            Background="{DynamicResource ControlFillColorDefaultBrush}"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
            BorderThickness="0,1,0,0">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>

				<!--  Status Message  -->
				<TextBlock
                    Grid.Column="0"
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                    Text="{Binding StatusMessage}" />

				<!--  Image Dimensions Info  -->
				<StackPanel
                    Grid.Column="1"
                    Orientation="Horizontal"
                    Visibility="{Binding CurrentImage, Converter={StaticResource NotNullToVisibilityConverter}}">
					<TextBlock VerticalAlignment="Center" Foreground="{DynamicResource TextFillColorSecondaryBrush}">
						<Run Text="Size:" />
						<Run Text="{Binding CurrentImage.PixelWidth, Mode=OneWay, FallbackValue=0}" />
						<Run Text=" x " />
						<Run Text="{Binding CurrentImage.PixelHeight, Mode=OneWay, FallbackValue=0}" />
					</TextBlock>
				</StackPanel>
			</Grid>
		</Border>
	</Grid>
</ui:FluentWindow>

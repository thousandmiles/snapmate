<ui:FluentWindow x:Class="SnapMate.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SnapMate.Views"
        xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
        mc:Ignorable="d"
     Title="SnapMate" 
        Height="800" Width="1400"
        WindowStartupLocation="CenterScreen"
        ExtendsContentIntoTitleBar="True"
    WindowBackdropType="Mica">
    
    <Grid>
      <Grid.RowDefinitions>
     <RowDefinition Height="Auto"/>
       <RowDefinition Height="*"/>
       <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

      <!-- Title Bar -->
        <ui:TitleBar Grid.Row="0" Title="SnapMate" />

        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
     <!-- Left Panel: History (280px default, resizable 200-400px) -->
            <ColumnDefinition Width="280" MinWidth="200" MaxWidth="400"/>
        <ColumnDefinition Width="Auto"/>
     <!-- Right Area: Editing Canvas -->
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

  <!-- LEFT PANEL: History List -->
            <Border Grid.Column="0" 
              Background="{DynamicResource ControlFillColorDefaultBrush}"
      BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
       BorderThickness="0,0,1,0">
        <Grid>
  <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
                  <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
          </Grid.RowDefinitions>

      <!-- History Header -->
       <StackPanel Grid.Row="0" Margin="15,15,15,10">
            <TextBlock Text="History" 
     FontSize="20" 
    FontWeight="SemiBold"
      Margin="0,0,0,10"/>
          
         <!-- Search Box -->
     <ui:TextBox PlaceholderText="Search..." 
     Icon="{ui:SymbolIcon Search24}"
    Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"/>
          </StackPanel>

      <!-- Quick Actions -->
   <StackPanel Grid.Row="1" Margin="15,5,15,10" Orientation="Horizontal">
              <ui:Button Content="New" 
     Icon="{ui:SymbolIcon Add24}"
 Appearance="Primary"
     Margin="0,0,5,0"
      ToolTip="New Screenshot (Ctrl+N)"/>
            <ui:Button Content="Clear" 
    Icon="{ui:SymbolIcon Delete24}"
           Margin="0,0,5,0"
        Command="{Binding ClearHistoryCommand}"
               ToolTip="Clear All History"/>
          <ui:Button Icon="{ui:SymbolIcon Settings24}"
  ToolTip="Settings"/>
              </StackPanel>

  <!-- History List with Thumbnails -->
         <ListView Grid.Row="2" 
      ItemsSource="{Binding Screenshots}"
           SelectedItem="{Binding SelectedScreenshot}"
          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
     BorderThickness="0"
              Margin="10,0,10,10">
             <ListView.ItemTemplate>
          <DataTemplate>
         <Border Background="{DynamicResource ControlFillColorSecondaryBrush}"
  CornerRadius="8"
              Margin="0,0,0,10"
  Padding="10"
       BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
      BorderThickness="1">
         <Grid>
     <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
    <RowDefinition Height="Auto"/>
 <RowDefinition Height="Auto"/>
   </Grid.RowDefinitions>

     <!-- Thumbnail Preview Placeholder -->
  <Border Grid.Row="0" 
            Height="120"
     Background="{DynamicResource ControlFillColorTertiaryBrush}"
 CornerRadius="4"
       Margin="0,0,0,8">
   <TextBlock Text="??" 
        FontSize="48"
       HorizontalAlignment="Center"
 VerticalAlignment="Center"
Opacity="0.3"/>
        </Border>

         <!-- Title/Date -->
  <TextBlock Grid.Row="1" 
        Text="{Binding Title, FallbackValue='Untitled'}"
     FontWeight="SemiBold"
         TextTrimming="CharacterEllipsis"
         Margin="0,0,0,4"/>

       <!-- Metadata -->
       <TextBlock Grid.Row="2"
       FontSize="11"
         Foreground="{DynamicResource TextFillColorSecondaryBrush}">
 <Run Text="{Binding CapturedAt, StringFormat=yyyy-MM-dd HH:mm}"/>
  <Run Text="?"/>
     <Run Text="{Binding Type}"/>
  </TextBlock>
             </Grid>
          </Border>
       </DataTemplate>
   </ListView.ItemTemplate>
      </ListView>
        </Grid>
   </Border>

            <!-- Resizable Splitter -->
         <GridSplitter Grid.Column="1" 
     Width="4" 
        HorizontalAlignment="Center" 
                   VerticalAlignment="Stretch"
             Background="Transparent"
       ShowsPreview="True"/>

            <!-- RIGHT AREA: Editing Canvas -->
            <Grid Grid.Column="2">
             <Grid.RowDefinitions>
         <RowDefinition Height="Auto"/>
<RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- TOP TOOLBAR: Editing Tools -->
                <Border Grid.Row="0" 
  Background="{DynamicResource ControlFillColorDefaultBrush}"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
       BorderThickness="0,0,0,1"
     Padding="15,10">
                    <Grid>
          <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="*"/>
      <ColumnDefinition Width="Auto"/>
     </Grid.ColumnDefinitions>

  <!-- Capture Tools -->
             <StackPanel Grid.Column="0" Orientation="Horizontal">
         <TextBlock Text="Capture:" 
           VerticalAlignment="Center" 
              Margin="0,0,10,0"
     FontWeight="SemiBold"/>
           
       <ui:Button Content="Region" 
     Icon="{ui:SymbolIcon Crop24}"
       Command="{Binding CaptureRegionCommand}"
       Appearance="Primary"
        Margin="0,0,5,0"
                ToolTip="Region Capture (Ctrl+Shift+A)"/>
              
    <ui:Button Content="Full Screen" 
Icon="{ui:SymbolIcon FullScreenMaximize24}"
        Command="{Binding CaptureFullScreenCommand}"
Margin="0,0,5,0"
      ToolTip="Full Screen (Ctrl+Shift+S)"/>
            
      <ui:Button Content="Window" 
    Icon="{ui:SymbolIcon Window24}"
   Margin="0,0,15,0"
ToolTip="Window Capture (Ctrl+Shift+W)"/>
 </StackPanel>

             <!-- Editing Tools -->
             <StackPanel Grid.Column="1" 
            Orientation="Horizontal" 
     HorizontalAlignment="Center">
              <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" 
   Margin="10,0"/>
      
        <TextBlock Text="Edit:" 
         VerticalAlignment="Center" 
        Margin="0,0,10,0"
          FontWeight="SemiBold"/>

    <ui:Button Icon="{ui:SymbolIcon ArrowUp24}"
    ToolTip="Arrow Tool"
         Margin="0,0,5,0"/>
          
      <ui:Button Icon="{ui:SymbolIcon RectangleLandscape24}"
        ToolTip="Rectangle Tool"
  Margin="0,0,5,0"/>
              
    <ui:Button Icon="{ui:SymbolIcon TextFont24}"
           ToolTip="Text Tool"
           Margin="0,0,5,0"/>
     
      <ui:Button Icon="{ui:SymbolIcon Blur24}"
           ToolTip="Mosaic/Blur Tool"
      Margin="0,0,5,0"/>
       
 <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" 
       Margin="10,0"/>
 </StackPanel>

  <!-- Action Tools -->
 <StackPanel Grid.Column="2" Orientation="Horizontal">
        <ui:Button Icon="{ui:SymbolIcon Copy24}"
           Content="Copy"
             Command="{Binding CopyToClipboardCommand}"
 Margin="0,0,5,0"
    ToolTip="Copy to Clipboard (Ctrl+C)"/>
  
         <ui:Button Icon="{ui:SymbolIcon Save24}"
          Content="Save"
      Command="{Binding SaveImageCommand}"
            Margin="0,0,5,0"
  ToolTip="Save Image (Ctrl+S)"/>
        
    <ui:Button Icon="{ui:SymbolIcon DocumentSearch24}"
         Content="OCR"
                  Command="{Binding ExtractTextCommand}"
        ToolTip="Extract Text"/>
        </StackPanel>
            </Grid>
                </Border>

    <!-- CENTRAL CANVAS: Image Editing Area -->
  <Border Grid.Row="1" 
     Background="{DynamicResource ApplicationBackgroundBrush}"
      Margin="10">
                    <Grid>
     <!-- Empty State -->
               <StackPanel HorizontalAlignment="Center" 
    VerticalAlignment="Center"
       Visibility="{Binding CurrentImage, Converter={StaticResource NullToVisibilityConverter}}">
     <TextBlock Text="??" 
       FontSize="72" 
    HorizontalAlignment="Center"
       Opacity="0.3"
            Margin="0,0,0,20"/>
            <TextBlock Text="No Screenshot Selected" 
  FontSize="24"
           FontWeight="SemiBold"
          HorizontalAlignment="Center"
  Foreground="{DynamicResource TextFillColorSecondaryBrush}"
     Margin="0,0,0,10"/>
          <TextBlock Text="Capture a new screenshot or select from history" 
    FontSize="14"
            HorizontalAlignment="Center"
           Foreground="{DynamicResource TextFillColorTertiaryBrush}"/>
      </StackPanel>

            <!-- Image Display with Annotation Layer -->
                 <ScrollViewer HorizontalScrollBarVisibility="Auto"
        VerticalScrollBarVisibility="Auto"
       Visibility="{Binding CurrentImage, Converter={StaticResource NotNullToVisibilityConverter}}">
             <Border BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
              BorderThickness="1"
     CornerRadius="8"
    Background="White"
            Padding="10">
     <Grid>
      <!-- Base Image -->
    <Image Source="{Binding CurrentImage}"
   Stretch="Uniform"
           HorizontalAlignment="Center"
                VerticalAlignment="Center"/>
   
               <!-- Annotation Overlay Layer -->
                 <Canvas Background="Transparent"/>
        </Grid>
      </Border>
          </ScrollViewer>
       </Grid>
       </Border>
            </Grid>
    </Grid>

        <!-- Status Bar -->
     <Border Grid.Row="2" 
                Background="{DynamicResource ControlFillColorDefaultBrush}"
          BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}"
  BorderThickness="0,1,0,0"
        Padding="15,8">
            <Grid>
   <Grid.ColumnDefinitions>
              <ColumnDefinition Width="*"/>
 <ColumnDefinition Width="Auto"/>
   </Grid.ColumnDefinitions>

          <!-- Status Message -->
    <TextBlock Grid.Column="0" 
    Text="{Binding StatusMessage}" 
   VerticalAlignment="Center"
      Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>

                <!-- Image Dimensions Info -->
      <StackPanel Grid.Column="1" 
      Orientation="Horizontal"
     Visibility="{Binding CurrentImage, Converter={StaticResource NotNullToVisibilityConverter}}">
            <TextBlock VerticalAlignment="Center" 
      Foreground="{DynamicResource TextFillColorSecondaryBrush}">
             <Run Text="Size:"/>
          <Run Text="{Binding CurrentImage.PixelWidth, FallbackValue=0}"/>
         <Run Text=" x "/>
           <Run Text="{Binding CurrentImage.PixelHeight, FallbackValue=0}"/>
    </TextBlock>
     </StackPanel>
   </Grid>
  </Border>
    </Grid>
</ui:FluentWindow>
